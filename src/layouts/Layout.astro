---
import type { ImageMetadata } from 'astro';
import '../css/global.css';

const { title, metadata } = Astro.props;

const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/pix/*.{jpg,png}');
const header = images['/src/assets/pix/avatar.png'];
if (!header) throw new Error(`The header could not be found`);

const pageMetadata = [{
  '@context': 'https://schema.org',
  '@type': 'WebPage',
  author: {
    '@type': 'Person',
    name: 'Mathieu Cartoixa'
  },
  headline: title || 'Mathieu Cartoixa',
  name: 'Mathieu Cartoixa',
  image: (await header()).default.src,
  url: Astro.url
}];
if (metadata) {
  if (metadata['@type'] === 'WebPage') {
    Object.assign(pageMetadata, metadata);
  } else {
    pageMetadata.push(metadata);
    if (metadata.description) {
      pageMetadata[0].description = metadata.description;
    }
    if (metadata.image) {
      pageMetadata[0].image = metadata.image;
    }
  }
}
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://tinylytics.app/embed/YTpdtwVFGaXTzYyCjW1Z.js" defer></script>

    <meta name="robots" content="index, follow" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content={Astro.generator} />

    <title>{title ? `${title} | Mathieu Cartoixa` : 'Mathieu Cartoixa'}</title>
    <meta property="og:title" content={title || 'Mathieu Cartoixa'} />
    <meta name="author" content={pageMetadata[0].author.name} />
    <meta property="og:locale" content="en_US" />
    <link rel="canonical" href={`${Astro.url}.html`} />
    <meta property="og:url" content={`${Astro.url}.html`} />
    <meta property="og:site_name" content="Mathieu Cartoixa" />
    <meta property="og:image" content={pageMetadata[0].image} />
    {(pageMetadata.length > 1 && pageMetadata[1]['@type'] === 'BlogPosting') && (
      <meta property="og:type" content="article" />
      <meta property="article:published_time" content={pageMetadata[1]?.datePublished} />
      <meta property="article:author" content={import.meta.env.SITE} />
    )}
    {(pageMetadata.length <= 1 || pageMetadata[1]['@type'] !== 'BlogPosting') && (
      <meta property="og:type" content="website" />
    )}
    {(pageMetadata[0].description) && (
      <meta name="description" content={pageMetadata[0].description} />
      <meta property="og:description" content={pageMetadata[0].description} />
    )}
    <meta name="twitter:card" content="summary" />
    <meta property="twitter:image" content={pageMetadata[0].image} />
    <meta property="twitter:title" content={pageMetadata[0].headline} />
    <meta name="twitter:site" content="@mcartoixa" />
    <meta name="twitter:creator" content="@mcartoixa" />
    <script type="application/ld+json" set:html={JSON.stringify(pageMetadata)} />

    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="theme-color" content="#ffffff" />

    <link rel="sitemap" href="/sitemap-index.xml" />
  </head>
  <body class="font-sans">
    <slot />
    <script src="../../node_modules/flowbite/dist/flowbite.js"></script>
  </body>
</html>
