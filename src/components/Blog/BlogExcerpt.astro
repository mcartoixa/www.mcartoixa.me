---
import type { ImageMetadata } from 'astro';
import { getEntry } from 'astro:content';
import { Image } from 'astro:assets';
import { createExcerpt, createUri } from "../../utils/blog";

interface Props {
  id: string;
}
const { id } = Astro.props;

const post = await getEntry('blogPosts', id);
if (!post) throw new Error(`Blog post "${id}" does not exist"`);

const postUrl = createUri(post).pathname;

const images = import.meta.glob<{ default: ImageMetadata }>('/src/data/blog/**/*.{jpg,png}');
const header = images[post.data.header] ?? images['/src/data/blog/header-mac.jpg'];
---

<section id={id} class="relative m-4 pt-8 pb-16 border-b-1 border-neutral-300 max-w-6xl overflow-hidden">
  <div class="relative mb-8 overflow-hidden p-16 text-shadow-md text-shadow-white">
    <Image
      src={header()}
      alt={post.data.title}
      class="absolute top-0 left-0 -z-1 h-full w-full object-cover object-center brightness-75"
    />
    <a href={postUrl}>
      <h2 class="font-800 mb-4 text-5xl">{post.data.title}</h2>
      <time class="text-xl" datetime={post.data.date.toISOString()}>{post.data.date.toLocaleDateString('en-US', { day: 'numeric', month: 'long', year: 'numeric' })}</time>
    </a>
  </div>
  <p class="font-light">{createExcerpt(post).substring(0, 500)}...</p>
</section>
