---
import { getEntry } from 'astro:content';

interface Props {
  id: string;
}
const { id } = Astro.props;

const post = await getEntry('blogPosts', id);
if (!post) throw new Error(`Blog post "${id}" does not exist"`);
---

<div id="disqus_thread" class="m-4 w-full"></div>
<script>
  /* eslint-disable */
  //cf. https://juanman.tech/blog/11
  const originalGetComputedStyle = window.getComputedStyle;
  window.getComputedStyle = function (element, pseudoElt) {
    const styles = originalGetComputedStyle(element, pseudoElt);
    return new Proxy(styles, {
      get(target, prop) {
        if (prop === 'getPropertyValue') {
          return (property) => {
            const value = target.getPropertyValue(property);
            if (value.includes('oklch')) {
              if (document.documentElement.classList.contains("dark")) {
                return 'black';
              }
              return 'white';
            }
            return value;
          };
        }
        return target[prop];
      },
    });
  };



  /**
   *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
   *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
  /*
  var disqus_config = function () {
  this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
  this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
  };
  */
  var disqus_config = function () {
    let postUrl = new URL(document.head.querySelector('[property~="og:url"][content]').content);
    this.page.url = postUrl.toString();
    this.page.identifier = postUrl.pathname.split('.').slice(0, -1).join('.');
  };
  (function () { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://mcartoixa.disqus.com/embed.js';
    s.setAttribute('data-timestamp', + new Date());
    (d.head || d.body).appendChild(s);
  })();
  /* eslint-enable */
</script>
<script id="dsq-count-scr" src="//mcartoixa.disqus.com/count.js" async></script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
