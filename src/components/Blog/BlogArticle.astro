---
import type { ImageMetadata } from 'astro';
import { getEntry, render } from 'astro:content';
import {Image} from "astro:assets";
import BlogSeriesHeader from "./BlogSeriesHeader.astro";

interface Props {
  id: string;
}
const { id } = Astro.props;

const post = await getEntry('blogPosts', id);
if (!post) throw new Error(`Blog post "${id}" does not exist"`);
const { Content } = await render(post);

const images = import.meta.glob<{ default: ImageMetadata }>('/src/data/blog/**/*.{jpg,png}');
const header = images[post.data.header] ?? images['/src/data/blog/header-mac.jpg'];
---

<article class="m-4 max-w-6xl">
  <header class="relative my-16 overflow-hidden p-16 text-shadow-md text-shadow-white">
    <Image
      src={header()}
      alt={post.data.title}
      class="absolute top-0 left-0 -z-1 h-full w-full object-cover object-center brightness-75"
    />
    <h2 class="font-800 mb-4 text-5xl">{post.data.title}</h2>
    <time class="text-xl" datetime={post.data.date.toISOString()}>{post.data.date.toLocaleDateString('en-US', { day: 'numeric', month: 'long', year: 'numeric' })}</time>
  </header>
  {post.data.series && <BlogSeriesHeader id={post.id} />}
  <main class="prose prose-base max-w-none prose-a:font-light prose-a:decoration-gray-400 prose-a:decoration-dashed prose-a:decoration-1 prose-code:font-monospace prose-code:font-normal prose-h2:mb-3 prose-h2:mt-8 prose-h3:mb-2.5 prose-h3:mt-6 prose-h4:mb-2.5 prose-h4:mt-4 prose-img:my-0.5 prose-li:my-0 prose-li:text-base/5 prose-p:text-base/5 prose-p:font-light prose-p:mb-2 prose-strong:font-normal prose-ul:my-0 prose-ul:font-light">
    <Content />
  </main>
</article>
